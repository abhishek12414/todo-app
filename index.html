<!DOCTYPE html>
<html>
    <head>
        <title>ShopNow</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="author" content="Abhishek Kumar">
        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.13/css/all.css" integrity="sha384-DNOHZ68U8hZfKXOrtjWvjxusGo9WQnrNx2sqG0tfsghAvtVlRW3tvkXWZh58N9jp" crossorigin="anonymous">
        <link href="https://fonts.googleapis.com/css?family=Arizonia" rel="stylesheet">
        <link rel="stylesheet" type="text/css" href="css/styles.css">
        <script type="text/javascript" src="js/main.js"></script>
    </head>
    <body>
        <header class="header-div">
            <div class="title">
                <h2>TODO</h2>
                <p>A way to track your work list.</p>
            </div>
        </header>

        <section class="section-add">
            <div>
                <input type="text" placeholder="Add your item" onkeydown="addChild(this)">
            </div>
        </section>

        <section id="section-todo-list">
            
        </section>

        <section id="section-taskStatus">
            <div>
                <p id="taskStatus"></p>
            </div>
        </section>


    </body>

    <script>

        let idCount = 0;
        let completedTask = new Array();

        const todoSection = document.getElementById('section-todo-list');
        
        function addChild(key) {            
            if(event.key == 'Enter') {
                
                //creating new root div
                let newDiv = document.createElement('div');
                newDiv.setAttribute("class", "item-list md-checkbox");
                newDiv.setAttribute("id", `row${++idCount}`);

                newDiv.innerHTML = `
                    <div> <input type="checkbox" id="checkbox${idCount}" onclick="changeState('row${idCount}')"><label for="checkbox${idCount}">${key.value}</label></div> 
                    <div class="item-move" onclick="removeTask('row${idCount}')"> <i class="icon-close">&times;</i></div> 
                `;

                todoSection.appendChild(newDiv);                
                updateTaskStatus();
            }
        }

        function changeState(divId) {
            
            const div = document.getElementById(`${divId}`);            
            const checkedStatus = div.getElementsByTagName('input')[0].checked;

            if(checkedStatus) {
                div.getElementsByTagName('label')[0].style.textDecoration = 'line-through';
            } else {
                div.getElementsByTagName('label')[0].style.textDecoration = 'none';
            }
            updateTaskStatus(divId);
        }

        function removeTask(divId) {
            document.getElementById(divId).remove();
            --idCount;
            updateTaskStatus(divId);
        }

        function updateTaskStatus(args) {
            if(args == null) {
                document.getElementById('taskStatus').innerHTML = "Task : "+ completedTask.length  + "/" + idCount;
            } else {
                console.log(args);      
                console.log(completedTask.length);

                if(completedTask.includes(args)) {
                    const index = completedTask.indexOf(args);
                    completedTask.splice(index, 1);
                } else {
                    completedTask[completedTask.length] = args;
                }

                document.getElementById('taskStatus').innerHTML = "Task : "+ completedTask.length  + "/" + idCount;
               
                    
            }

            if(idCount == 0) {
                document.getElementById('taskStatus').innerHTML = "";
            }
            
        }

    </script>
</html>